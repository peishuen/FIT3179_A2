{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width": 800,
  "height": 450,

  "title": {
    "text": "Malaysiaâ€™s Exports and Imports (2017-2023)"
  },

  "data": {
    "url": "https://raw.githubusercontent.com/peishuen/FIT3179_A2/main/idioms/multi_line_chart/exports_imports.csv",
    "format": {"type": "csv"}
  },

  "transform": [
      {"calculate": "format(datum.Value, '.1f') + '%'", "as": "ValueLabel"}
  ],

  "layer": [
    {
      "mark": {
        "type": "rect",
        "color": "lightgray",
        "opacity": 0.1
      },
      "encoding": {
        "x": {
          "datum": {"year": 2020, "month": 1, "date": 1},
          "type": "temporal"
        },
        "x2": {
          "datum": {"year": 2021, "month": 12, "date": 31}, 
          "type": "temporal"
        }
      }
    },

    {
      "mark": {
        "type": "text",
        "align": "center",
        "dx": 95,
        "dy": -10,
        "color": "gray"
      },
      "encoding": {
        "x": {
          "datum": {"year": 2020, "month": 5, "date": 1},
          "type": "temporal"
        },
        "y": {
          "datum": 80
        },
        "text": {"value": "COVID-19 Pandemic"}
      }
    },

    {
      "params": [
          {
            "name": "highlight",
            "select": {
              "type": "point",
              "fields": ["Indicator Name"],
              "on": "click",
              "clear": "dblclick"
            }
          }
      ],
      "mark": {"type": "line", "strokeWidth": 3, "strokeCap": "round"},
      "encoding": {
        "x": {
          "field": "Year",
          "type": "temporal",
          "timeUnit": "year",
          "title": "Year",
          "axis": {"grid": false, "labelAngle": 0, "tickCount": {"interval": "year", "step": 1}}
        },
        "y": {
          "field": "Value",
          "type": "quantitative",
          "title": "Trade (% of GDP)"
        },
        "color": {
          "field": "Indicator Name",
          "type": "nominal",
          "title": null,
          "scale": {"range": ["#C2715F", "#54859E"]},
          "legend": null
        },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.2
        },
        "tooltip": [
          {"field": "Year", "title": "Year", "type": "temporal", "format": "%Y"},
          {"field": "Indicator Name", "title": "Indicator"},
          {"field": "ValueLabel", "title": "Value"}
        ]
      }
    },

    {
      "mark": {"type": "circle", "size": 60, "opacity": 1},
      "encoding": {
        "x": {
          "field": "Year", 
          "type": "temporal"
        },
        "y": {
          "field": "Value", 
          "type": "quantitative"
        },
        "color": {
          "field": "Indicator Name", 
          "type": "nominal", "legend": null
        },
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.2
        },
        "tooltip": [
          {"field": "Year", "title": "Year", "type": "temporal", "format": "%Y"},
          {"field": "Indicator Name", "title": "Indicator"},
          {"field": "ValueLabel", "title": "Value"}
        ]
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Imports"}]
      },
      "mark": {
        "type": "text",
        "align": "center",
        "dx": -180,
        "dy": -85,
        "color": "#54859E",
        "fontWeight": 600,
        "fontSize": 17
      },
      "encoding": {
        "text": {"field": "Indicator Name"},
        "opacity": {
          "condition" : {"param": "highlight", "value": 1},
          "value": 0.2
        }
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Exports"}]
      },
      "mark": {
        "type": "text",
        "align": "center",
        "dx": -80,
        "dy": -155,
        "color": "#C2715F",
        "fontWeight": 600,
        "fontSize": 17
      },
      "encoding": {
        "text": {"field": "Indicator Name"},
        "opacity": {
          "condition": {"param": "highlight", "value": 1},
          "value": 0.2
        }
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Exports"}]
      },
      "mark": {
        "type": "rect",
        "color": "#fff8e1",
        "stroke": "#c08d01",
        "strokeWidth": 1.2,
        "cornerRadius": 0
      },
      "encoding": {
        "x": {"datum": {"year": 2022, "month": 1, "date": 15}, "type": "temporal"},
        "x2": {"datum": {"year": 2022, "month": 12, "date": 15}, "type": "temporal"},
        "y": {"datum": 60},
        "y2": {"datum": 45},
        "opacity": {
          "condition" : {"param": "highlight", "value": 1},
          "value": 0
        }
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Exports"}]
      },
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "middle",
        "dx": 67,
        "dy": -98
      },
      "encoding": {
        "text": {
          "value": ["Semiconductor", "boom and global", "reopening rapidly", "boosted exports."]
        },
        "opacity": {
          "condition" : {"param": "highlight", "value": 1},
          "value": 0
        },
        "x": {"datum": {"year": 2022, "month": 1, "date": 1}, "type": "temporal"}
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Exports"}]
      },
      "mark": {
        "type": "rule",
        "color": "#c08d01",
        "strokeWidth": 1.3
      },
      "encoding": {
        "x": {"datum": {"year": 2022, "month": 7, "date": 1}, "type": "temporal"},
        "x2": {"datum": {"year": 2022, "month": 1, "date": 1}, "type": "temporal"},
        "y": {"datum": 60},
        "y2": {"datum": 76.9},
        "opacity": {
            "condition": {
              "test": "!length(data('highlight_store')) || datum['Indicator Name'] == highlight['Indicator Name']",
              "value": 1
            },
            "value": 0
        }
      }
    },

    {
      "mark": {
        "type": "rect",
        "color": "#fff8e1",
        "stroke": "#c08d01",
        "strokeWidth": 1.2,
        "cornerRadius": 0
      },
      "encoding": {
        "x": {"datum": {"year": 2018, "month": 1, "date": 1}, "type": "temporal"},
        "x2": {"datum": {"year": 2019, "month": 11, "date": 1}, "type": "temporal"},
        "y": {"datum": 48},
        "y2": {"datum": 39}
      }
    },

    {
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "middle",
        "dx": -111,
        "dy": -30
      },
      "encoding": {
        "x": {"datum": {"year": 2019, "month": 10, "date": 1}, "type": "temporal"},
        "text": {
          "value": ["Border closures and supply", "chain breakdowns disrupted trade."]
        }
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Imports"}]
      },
      "mark": {
        "type": "rule",
        "color": "#c08d01",
        "strokeWidth": 1.3
      },
      "encoding": {
        "x": {"datum": {"year": 2019, "month": 2, "date": 1}, "type": "temporal"},
        "x2": {"datum": {"year": 2020, "month": 1, "date": 1}, "type": "temporal"},
        "y": {"datum": 48},
        "y2": {"datum": 55.2},
        "opacity": {
            "condition": {
              "test": "!length(data('highlight_store')) || datum['Indicator Name'] == highlight['Indicator Name']",
              "value": 1
            },
            "value": 0
        }
      }
    },

    {
      "data": {
        "values": [{"Indicator Name": "Exports"}]
      },
      "mark": {
        "type": "rule",
        "color": "#c08d01",
        "strokeWidth": 1.3
      },
      "encoding": {
        "x": {"datum": {"year": 2019, "month": 2, "date": 1}, "type": "temporal"},
        "x2": {"datum": {"year": 2020, "month": 1, "date": 1}, "type": "temporal"},
        "y": {"datum": 48},
        "y2": {"datum": 61.6},
        "opacity": {
            "condition": {
              "test": "!length(data('highlight_store')) || datum['Indicator Name'] == highlight['Indicator Name']",
              "value": 1
            },
            "value": 0
        }
      }
    }
  ],
  
  "config": {
    "title": {
      "fontSize": 25, 
      "fontWeight": "bold", 
      "offset": 20,
      "color": "#5c5c5c",
      "align": "center"
    },
    "axis": {
      "titleFontSize": 15, 
      "titlePadding": 18, 
      "titleFontWeight": 600, 
      "titleColor": "#858585",
      "labelFontSize": 13, 
      "labelFontWeight": 200,
      "labelColor": "#858585"
    },
    "text": {
      "fontWeight": "lighter",
      "fontSize": 15,
      "color": "#858585"
    }
  }  
}
